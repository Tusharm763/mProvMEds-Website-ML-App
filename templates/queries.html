<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='modern-styles.css') }}">
    <title>Admin - mProvMEds</title>
    <script src="{{ url_for('static', filename='this-script.js') }}"></script>
    <style>
        @media screen and (max-width: 768px) {
            body {
            font-family: Arial, sans-serif;
<!--            display: flex;-->
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
            .message {
                display: block;
            }
        }
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-wrapper input[type="password"],
        .input-wrapper input[type="text"] {
            padding-right: 45px;
            width: 100%;
            padding: 12px 8px 8px 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .submit-btn {
            position: absolute;
            right: 8px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .submit-btn:hover {
            background-color: #2563eb;
        }

        .main-admin-password-protected {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f3f4f6;
            border-radius: 8px;
            border: 1px solid #d1d5db;
        }

        .clickable-row {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .clickable-row:hover {
            background-color: #f8fafc;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .clickable-row:active {
            transform: translateY(0);
        }

        /* Dialog Overlay Styles */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(2.5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .dialog-card {
            background: white;
            border-radius: 15px;
            padding: 0;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            animation: slideUp 0.3s ease forwards;
            position: relative;
        }

        .dialog-header {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 15px 15px 0 0;
        }

        .dialog-title {
            font-size: 1rem;
            font-weight: bold;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .dialog-content {
            padding: 2rem;
            max-height: 60vh;
            overflow-y: auto;
        }

        .query-info-grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .info-item {
            border-left: 4px solid #2563eb;
            padding-left: 1rem;
        }

        .info-label {
            font-weight: bold;
            color: #374151;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .info-value {
            color: #1f2937;
            font-size: 1rem;
            word-wrap: break-word;
        }

        .priority-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .message-body {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .dialog-actions {
            display: flex;
            gap: 1rem;
            padding: 0 2rem 2rem 2rem;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-reply {
            background: #2563eb;
            color: white;
            margin: 0.15rem;
        }

        .btn-reply:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .btn-delete {
            background: #dc2626;
            color: white;
            margin: 0.15rem;
        }

        .btn-delete:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }

        .btn-delete:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .btn-view-details {
            background: #059669;
            color: white;
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-view-details:hover {
            background: #047857;
            transform: translateY(-1px);
        }

        /* Alert Dialog Styles */
        .alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .alert-card {
            background: white;
            border-radius: 12px;
            padding: 0;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            transform: scale(0.9);
            animation: slideUp 0.3s ease forwards;
            position: relative;
            overflow: hidden;
        }

        .alert-header {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            padding: 1.5rem;
            text-align: center;
            position: relative;
        }

        .alert-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .alert-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin: 0;
        }

        .alert-content {
            padding: 2rem;
            text-align: center;
        }

        .alert-message {
            color: #374151;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 2rem;
        }

        .alert-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            padding: 0 2rem 2rem 2rem;
        }

        .alert-btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
            min-width: 100px;
        }

        .alert-btn-confirm {
            background: #dc2626;
            color: white;
        }

        .alert-btn-confirm:hover {
            background: #b91c1c;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .alert-btn-cancel {
            background: #f3f4f6;
            color: #374151;
            border: 2px solid #e5e7eb;
        }

        .alert-btn-cancel:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .dialog-card {
                width: 95%;
                max-height: 90vh;
            }

            .dialog-header {
                padding: 1rem 1.5rem;
            }

            .dialog-content {
                padding: 1.5rem;
            }

            .dialog-actions {
                padding: 0 1.5rem 1.5rem 1.5rem;
                flex-direction: column;
            }

            .alert-card {
                width: 95%;
            }

            .alert-actions {
                flex-direction: column;
                gap: 0.75rem;
            }

            .alert-btn {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="nav-left">
            <a href="{{ url_for('index') }}" class="app-name"
                style="display: flex; justify-content: center; align-items: center;">
                <img style="border-radius: 50%;margin-right: 8px;"
                    src="{{ url_for('static', filename='mProvMEds-logo-Icon-circular.png') }}"
                    alt="mProvMeds Logo" height="40" width="40">
                mProvMeds: Admin
            </a>
<!--            <div class="divider-nav" style="border-left: 3px solid #2563eb;"></div>-->
<!--           -->
<!--            <ul class="nav-links">-->
<!--                <li><a href="{{ url_for('index_form') }}" class="nav-link">Create Prediction</a></li>-->
<!--                <li><a href="{{ url_for('my_predictions') }}" class="nav-link">My Predictions</a></li>-->
<!--                <li><a href="{{ url_for('about') }}" class="nav-link">About Us</a></li>-->
<!--            </ul> -->
        </div>

<!--        {% if username %}-->
<!--        <div class="user-dropdown">-->
<!--            <button class="user-button" onclick="toggleDropdown()">-->
<!--                <span id="userName">{{ username }}</span>-->
<!--                <span class="dropdown-arrow">▼</span>-->
<!--            </button>-->
<!--            <div class="dropdown-menu" id="dropdownMenu">-->
<!--                <div class="dropdown-item">Signed in as <strong>{{ username }}</strong></div>-->
<!--                <div class="dropdown-item">-->
<!--                    <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--        {% endif %}-->
    </nav>

    <!-- Custom Alert Dialog -->
    <div class="alert-overlay" id="alertDialog">
        <div class="alert-card">
            <div class="alert-header">
                <span class="alert-icon" id="alert-icon">⚠️</span>
                <h3 class="alert-title" id="alert-title">Confirm Action</h3>
            </div>
            <div class="alert-content">
                <p class="alert-message" id="alert-message">Are you sure you want to proceed?</p>
            </div>
            <div class="alert-actions">
                <button class="alert-btn alert-btn-cancel" id="alert-cancel">Cancel</button>
                <button class="alert-btn alert-btn-confirm" id="alert-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <div class="dialog-overlay" id="queryDialog" onclick="closeDialog(event)">
        <div class="dialog-card" onclick="event.stopPropagation()">
            <div class="dialog-header">
                <h2 class="dialog-title">Query Details</h2>
                <button class="close-btn" onclick="closeDialog()">&times;</button>
            </div>
            <div class="dialog-content">
                <div class="query-info-grid">
                    <div class="info-item">
                        <div class="info-label">Subject</div>
                        <div class="info-value" id="modal-subject"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">From</div>
                        <div class="info-value" id="modal-from"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Related To</div>
                        <div class="info-value" id="modal-related"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Priority</div>
                        <div class="info-value" id="modal-priority"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Message Body</div>
                        <div class="message-body" id="modal-body"></div>
                    </div>
                </div>
            </div>
            <div class="dialog-actions">
                <button class="action-btn btn-reply" id="modal-reply-btn">
                    📧 Reply via Email
                </button>
                <button class="action-btn btn-delete" id="modal-delete-btn">
                    🗑️ Delete Query
                </button>
            </div>
        </div>
    </div>

    <div class="container main-content fade-in">
        <div class="queries-container">
            <h2 style="color: var(--primary-color); margin-bottom: 1.5rem; text-align: center;">
                Admin Console | Contact Queries Management
            </h2>
            <div class="form-group-admin" style="width: 50%;justify-content: center;align-items: center;margin: auto">
                <label for="adminpassword1">Password *</label>
                <div class="input-wrapper">
                    <input type="password" id="password" name="adminpassword1" required placeholder="Enter password"
                        minlength="6">
                    <!-- <button type="button" class="submit-btn" onclick="checkPassword()">→</button> -->
                </div>
                <small style="color: #6b7280; font-size: 0.8rem;">At least 6 characters | click 'Enter'</small>
                <!-- <div style="margin-top: 0.5rem;">
                    <input type="checkbox" id="showPassword" onchange="togglePasswords()">
                    <label for="showPassword" style="display: inline; margin-left: 0.5rem; font-size: 0.9rem;">Show
                        passwords</label>
                </div> -->
            </div>
            <!-- <div class="form-group" style="width: 50%;justify-content: center;align-items: center;margin: auto">
                <label for="adminpassword">Password *</label>
                <input type="password" id="password" name="adminpassword" required placeholder="Enter password"
                    minlength="6">
                <small style="color: #6b7280; font-size: 0.8rem;">At least 6 characters</small>
                <div style="margin-top: 0.5rem;">
                    <input type="checkbox" id="showPassword" onchange="togglePasswords()">
                    <label for="showPassword" style="display: inline; margin-left: 0.5rem; font-size: 0.9rem;">Show
                        passwords</label>
                </div>
            </div> -->
<!--            <div class="form-group-admin" style="height: 1.5rem;"></div>-->
            <div class="main-admin-password-protected" id="adminContent" style="display: none;">
                <div class="stats-cards-1">
                    <div class="stat-card-1">
                        <h3 id="total-queries">0</h3>
                        <p>Total Queries</p>
                    </div>
                    <div class="stat-card-1" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <h3 id="filtered-queries">0</h3>
                        <p>Filtered Results</p>
                    </div>
                    <div class="stat-card-1" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <h3 id="pending-queries">0</h3>
                        <p>High Priority</p>
                    </div>
                    <div class="stat-card-1" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                        <h3 id="today-queries">0</h3>
                        <p>Today's Queries</p>
                    </div>
                </div>


                <div class="filters-section">
                    <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Filter & Search</h3>
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label for="search-name">Search - Name</label>
                            <input type="text" id="search-name" placeholder="Enter name...">
                        </div>
                        <div class="filter-group">
                            <label for="search-email">Search - Email</label>
                            <input type="email" id="search-email" placeholder="Enter email...">
                        </div>
                        <div class="filter-group" style="width:140px;">
                            <label for="filter-type">Type</label>
                            <select id="filter-type">
                                <option value="">All Types</option>
                                <option value="contact">Contact</option>
                                <option value="suggestion">Suggestion</option>
                                <option value="report">Report</option>
                                <option value="feedback">Feedback</option>
                                <option value="support">Support</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="filter-group" style="width:130px;">
                            <label for="filter-priority">Priority</label>
                            <select id="filter-priority">
                                <option value="">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <div class="filter-group" style="width:130px;">
                            <label for="filter-date">Date</label>
                            <input type="date" id="filter-date">
                        </div>
                        <div class="filter-group" style="width:130px;">
                            <button onclick="exportFiltered()" class="export-btn">
                                Export ↗️
                            </button>
                        </div>
                        <div class="filter-group" style="width:130px;">
                            <button onclick="clearFilters()" class="btn btn-outline"
                                style="padding: 0.5rem 1rem;color:white;background:red;border: 2px solid white;">
                                Clear
                            </button>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="queries-table" id="queries-table">
                        <thead>
                            <tr>
                                <th onclick="sortTable(0)">Date/Time ↕</th>
                                <th onclick="sortTable(1)">Name ↕</th>
                                <th onclick="sortTable(2)">Email ↕</th>
                                <th onclick="sortTable(3)">Type ↕</th>
                                <th onclick="sortTable(4)">Priority ↕</th>
                                <th>Subject</th>
                            </tr>
                        </thead>
                        <tbody id="queries-tbody">
                            {% for query in queries %}
                            <tr data-timestamp="{{ query.timestamp }}" data-name="{{ query.name.lower() }}"
                                data-email="{{ query.email.lower() }}" data-type="{{ query.contact_type }}"
                                data-priority="{{ query.priority }}" data-subject="{{ query.subject or 'No subject' }}"
                                data-full-name="{{ query.name }}" data-full-email="{{ query.email }}"
                                data-contact-type="{{ query.contact_type.title() }}" data-query="{{ query.query }}"
                                class="clickable-row" onclick="showQueryDialog(this)" title="View details">
                                <td>{{ query.timestamp }}</td>
                                <td>{{ query.name }}</td>
                                <td style="max-width:10rem"><a href="mailto:{{ query.email }}"
                                        style="color: var(--primary-color);" onclick="event.stopPropagation()">{{
                                        query.email }}</a></td>
                                <td>
                                    <span class="type-badge type-{{ query.contact_type }}">
                                        {{ query.contact_type.title() }}
                                    </span>
                                </td>
                                <td class="priority-{{ query.priority }}">{{ query.priority.title() }}</td>
                                <td>{{ query.subject or 'No subject' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div id="no-results" class="no-results" style="display: none;">
                        No queries match your current filters.
                    </div>
                </div>
            </div>
        </div>

    </div>
    <br><br>
    <footer class="site-footer">
        <div class="footer-content"><br><br>
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>🏥 About mProvMeds</h3>
                    <p style="text-align:justify;">We are a team of dedicated individuals working to provide valuable
                        predictions and insights into various diseases based on symptoms input. Our goal is to improve
                        healthcare outcomes and empower individuals to make informed decisions about their health.</p>
                    <a href="#" title="LinkedIn"
                        style="display: inline-flex;align-items: center;justify-content: center;margin-top:0.6rem;letter-spacing:2.5px;">
                        <img style="margin-right:4px;" src="https://www.svgrepo.com/show/157006/linkedin.svg"
                            height="22.5" width="22.5">
                        LinkedIn

                    </a>
                    <a style="color:transparent;height:rem;">_</a>
                    <a style="border-left: 3px solid #2563eb;color:transparent;height:2rem;font-size:2rem;">_</a>
                    <a href="#" title="Github"
                        style="display: inline-flex;align-items: center;justify-content: center;margin-top:0.6rem;letter-spacing:2.5px;">
                        <img style="margin-right:4px;" src="https://www.svgrepo.com/show/512317/github-142.svg"
                            height="22.5" width="22.5">
                        Github

                    </a>
                </div>

                <div class="footer-section" style="padding-left:45px;">
                    <h3>🔗 Quick Links</h3>
                    <ul>
                        <li><a href="{{ url_for('index') }}">🏠 Home</a></li>
                        <li><a href="{{ url_for('index_form') }}">➕ Create New Prediction</a></li>
                        <li><a href="{{ url_for('my_predictions') }}">📊 My Predictions</a></li>
                        <li><a href="{{ url_for('about') }}">ℹ️ About Us</a></li>
                        <li>
                            <p style="font-size:0%;">.</p>
                        </li>
                        <li>
                            <p style="font-size:0%;">.</p>
                        </li>
                        <li><a href="{{ url_for('contact') }}">📞 Contact Support</a></li>
                        <li><a href="#">📋 Terms of Service</a></li>
                        <li><a href="#">🔒 Privacy Policy</a></li>
                    </ul>
                </div>


                <div class="footer-section">
                    <h3>📍 Contact Information</h3>
                    <p>📧 Email:<br> <a href="mailto:{{ support_email }}">{{ support_email }}</a></p>
                    <p style="font-size:0%;">.</p>
                    <p>📱 Phone:<br> {{ support_phone }}</p>
                    <p style="font-size:0%;">.</p>
                    <p>🏢 Address: <br>Academic Office, VIT Bhopal University,<br>
                        Bhopal, Madhya Pradesh, India</p>
                    <p style="font-size:0%;">.</p>
                </div>
            </div>
            <br>

            <div class="disclaimer-box">
                <h4>⚠️ Important Medical Disclaimer</h4>
                <p style="text-align:justify; color: #dfdfdf">This application is for informational and educational
                    purposes only. It is not intended to be a substitute for professional medical advice, diagnosis, or
                    treatment. Always seek the advice of your physician or other qualified health provider with any
                    questions you may have regarding a medical condition. Never disregard professional medical advice or
                    delay in seeking it because of something you have read on this application.</p>
            </div>

            <div class="footer-bottom">
                <div class="copyright-info">
                    <p style="font-size:1rem;"><br>
                        &copy; 2023 mProvMeds - Healthcare Improvements Platform. All rights reserved. | Powered by
                        NAMETAG</p>
                </div>

                <p style="margin-top: 1rem; color: #d1d5db; font-size: 0.9rem;">
                    Version {{ver}} | Last Updated: {{updatedOn}} |
                    <a href="{{ url_for('contact') }}" style="color: #93c5fd;">Report Issues</a> |
                    <a href="{{ url_for('contact') }}" style="color: #93c5fd;">Suggest Features</a>|
                    <a href="{{ url_for('view_all_queries') }}" style="color: #93c5fd;">Admin Console</a>
                </p>
                <p style="margin-top: 1rem; color: #d1d5db; font-size: 0.9rem;">
                    <a href="https://www.python.org/" target="_blank" style="color: #93c5fd; font-size: 0.75rem;">
                        Python</a> |
                    <a href="https://www.google.com/search?q=machine+learning&rlz=1C1VDKB_enIN988IN988&oq=MAchine&gs_lcrp=EgZjaHJvbWUqDwgBEAAYQxixAxiABBiKBTIMCAAQRRg5GLEDGIAEMg8IARAAGEMYsQMYgAQYigUyCggCEAAYsQMYgAQyBwgDEAAYgAQyBwgEEAAYgAQyCggFEAAYsQMYgAQyBggGEEUYPTIGCAcQRRhB0gEIMzU1NmowajSoAgCwAgA&sourceid=chrome&ie=UTF-8"
                        target="_blank" style="color: #93c5fd; font-size: 0.75rem;">
                        Machine Learning</a> |
                    <a href="https://flask.palletsprojects.com" target="_blank"
                        style="color: #93c5fd; font-size: 0.75rem;">
                        Flask</a> |
                    <a href="https://www.google.com/search?q=html+css&sca_esv=71a2141a21d8c97d&rlz=1C1VDKB_enIN988IN988&sxsrf=AE3TifMumyHis7wMC95WamCUIAtFR_neXg%3A1756302710342&ei=dg2vaKzfFOrdseMP2722-A4&ved=0ahUKEwis8qu5kauPAxXqbmwGHdueDe8Q4dUDCBA&uact=5&oq=html+css&gs_lp=Egxnd3Mtd2l6LXNlcnAiCGh0bWwgY3NzMgUQABiABDIFEAAYgAQyCBAAGIAEGLEDMgUQABiABDIFEAAYgAQyBRAAGIAEMgUQABiABDIFEAAYgAQyBRAAGIAEMggQABiABBixA0ixL1CGKVjRLnACeAGQAQCYAcUBoAGFBKoBAzAuM7gBA8gBAPgBAZgCBaACsgTCAgcQIxiwAxgnwgIKEAAYsAMY1gQYR8ICChAjGIAEGCcYigXCAg0QABiABBixAxhDGIoFwgIKEAAYgAQYQxiKBcICDhAAGIAEGLEDGIMBGIoFwgILEAAYgAQYsQMYgwGYAwCIBgGQBgqSBwUyLjIuMaAHhxOyBwUwLjIuMbgHmwTCBwUyLTQuMcgHJQ&sclient=gws-wiz-serp"
                        target="_blank" style="color: #93c5fd; font-size: 0.75rem;">
                        HTML5/CSS3</a> |
                    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank"
                        style="color: #93c5fd; font-size: 0.75rem;">
                        JavaScript</a> |
                    <a href="https://developer.mozilla.org/en-US/docs/Learn_web_development/Core/CSS_layout/Responsive_Design"
                        target="_blank" style="color: #93c5fd; font-size: 0.75rem;">
                        Responsive Design</a>
                </p>
            </div>
        </div>
    </footer>

    <script id="predictions-data" type="text/javascript" >
        passwordDataAdmin = '{{ passwordAdmin }}'
    </script>
    <script>
        passSubmit = null;
        // Function to create and add submit button with arrow icon
        function addSubmitButton() {
            const formGroup = document.querySelector('.form-group');
            const passwordInput = document.getElementById('password');

            // Create wrapper div for input and button
            const inputWrapper = document.createElement('div');
            inputWrapper.style.cssText = `
        position: relative;
        display: flex;
        align-items: center;
    `;

            // Insert wrapper before the input
            passwordInput.parentNode.insertBefore(inputWrapper, passwordInput);

            // Move input into wrapper
            inputWrapper.appendChild(passwordInput);

            // Style the input to make room for the button
            passwordInput.style.paddingRight = '45px';

            // Create submit button with arrow icon
            const submitButton = document.createElement('button');
            submitButton.type = 'button';
            submitButton.innerHTML = '→';
            submitButton.style.cssText = `
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 4px;
        width: 30px;
        height: 30px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s;
    `;

            // Add hover effect
            submitButton.addEventListener('mouseenter', function () {
                this.style.backgroundColor = '#2563eb';
            });

            submitButton.addEventListener('mouseleave', function () {
                this.style.backgroundColor = '#3b82f6';
            });

            // Add click event to submit button
            submitButton.addEventListener('click', function () {
                checkPassword();
            });

            // Append button to wrapper
            inputWrapper.appendChild(submitButton);
        }
        // Password protection functionality
        async function checkPassword() {
            const passwordInput = document.getElementById('password');
            const protectedDiv = document.querySelector('.main-admin-password-protected#adminContent');
            const protectedDivPass = document.querySelector('.form-group-admin');
<!--            const passwordDataAdmin = document.getElementById('password-data').textContent;-->
            const correctPassword = passwordDataAdmin;
            console.log(passwordDataAdmin);

            if (passSubmit === correctPassword) {
                // Show the protected div
                if (protectedDiv) {
                    protectedDiv.style.display = 'block';
                    protectedDivPass.style.display = 'none';
                }
                document.title = "Contact Queries - mProvMEds Admin";
            } else {
                // Hide the protected div
                
                if (protectedDiv) {
                    protectedDiv.style.display = 'none';
                }
                await showConfirm(
                    '',
                    'Incorrect Password. Please try again.',null,
                    closeDialog,
                    closeDialog
                );
            }
        }

        // Function to toggle password visibility (for your existing checkbox)
        function togglePasswords() {
            const passwordInput = document.getElementById('password');
            const showPasswordCheckbox = document.getElementById('showPassword');

            if (showPasswordCheckbox.checked) {
                passwordInput.type = 'text';
            } else {
                passwordInput.type = 'password';
            }
        }

        // Add event listener to check password on input
        document.addEventListener('DOMContentLoaded', function () {
            const passwordInput = document.getElementById('password');

            // Check password on every keystroke
            //passwordInput.addEventListener('input', checkPassword);

            // Also check on form submission or Enter key
            passwordInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    passSubmit = passwordInput.value;
                    checkPassword();
                }
            });

            // Initially hide the protected div
            const protectedDiv = document.querySelector('.main-admin-password-protected#body');
            if (protectedDiv) {
                protectedDiv.style.display = 'none';
            }
        });

        // Alternative: If you want to check password only on button click
        function validatePassword() {
            passSubmit = document.getElementById('password').value; 
            checkPassword();
        }
        // Global variables
        let originalRows = [];
        let sortDirection = {};

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            // Check if we're on the queries page
            const queriesTable = document.getElementById('queries-table');
            if (queriesTable) {
                originalRows = Array.from(document.querySelectorAll('#queries-tbody tr'));
                updateStats();
                setupEventListeners();
            }
        });

        function updateStats() {
            const totalQueries = originalRows.length;
            const visibleQueries = originalRows.filter(row => !row.classList.contains('hidden')).length;
            const highPriorityQueries = originalRows.filter(row =>
                row.dataset.priority === 'high' && !row.classList.contains('hidden')).length;

            // Count today's queries - using dd/mm/yyyy format
            const today = new Date();
            const todayFormatted = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;

            const todayQueries = originalRows.filter(row => {
                const rowDate = row.dataset.timestamp.split(' ')[0];
                return rowDate === todayFormatted && !row.classList.contains('hidden');
            }).length;

            document.getElementById('total-queries').textContent = totalQueries;
            document.getElementById('filtered-queries').textContent = visibleQueries;
            document.getElementById('pending-queries').textContent = highPriorityQueries;
            document.getElementById('today-queries').textContent = todayQueries;
        }

        // Reply to query
        function replyToQuery(email, subject) {
            const replySubject = subject ? `Re: ${subject}` : 'Re: Your inquiry';
            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(replySubject)}`;
            window.location.href = mailtoLink;
        }

        // Custom confirmation dialog
        function showConfirm(title, message, icon = '⚠️', onConfirm = null, onCancel = null) {
            return new Promise((resolve) => {
                const alertDialog = document.getElementById('alertDialog');
                const alertTitle = document.getElementById('alert-title');
                const alertMessage = document.getElementById('alert-message');
                const alertIcon = document.getElementById('alert-icon');
                const confirmBtn = document.getElementById('alert-confirm');
                const cancelBtn = document.getElementById('alert-cancel');

                // Set content
                alertTitle.textContent = title;
                alertMessage.textContent = message;
                alertIcon.textContent = icon;

                // Setup button handlers
                const handleConfirm = () => {
                    alertDialog.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    if (onConfirm) onConfirm();
                    resolve(true);
                };

                const handleCancel = () => {
                    alertDialog.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    if (onCancel) onCancel();
                    resolve(false);
                };

                // Remove previous event listeners
                const newConfirmBtn = confirmBtn.cloneNode(true);
                const newCancelBtn = cancelBtn.cloneNode(true);
                confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
                cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);

                // Add new event listeners
                newConfirmBtn.addEventListener('click', handleConfirm);
                newCancelBtn.addEventListener('click', handleCancel);

                // Show dialog
                alertDialog.style.display = 'flex';
                document.body.style.overflow = 'hidden';

                // Focus on cancel button by default
                newCancelBtn.focus();
            });
        }

        // Delete query with backend integration
        async function deleteQueryByTimestamp(timestamp) {
            try {
                // Show custom confirmation dialog
                const confirmed = await showConfirm(
                    'Delete Query',
                    'Are you sure you want to permanently delete this query? This action cannot be undone.',
                    '🗑️'
                );

                if (!confirmed) {
                    return;
                }

                // Disable delete button to prevent multiple clicks
                const deleteBtn = document.getElementById('modal-delete-btn');
                if (deleteBtn) {
                    deleteBtn.disabled = true;
                    deleteBtn.textContent = '🗑️ Deleting...';
                }

                const response = await fetch('/queries/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ timestamp: timestamp })
                });

                const result = await response.json();

                if (result.success) {
                    // Find and remove the row from DOM
                    const rowToDelete = originalRows.find(row => row.dataset.timestamp === timestamp);
                    if (rowToDelete) {
                        rowToDelete.style.transition = 'opacity 0.3s ease';
                        rowToDelete.style.opacity = '0';

                        setTimeout(() => {
                            rowToDelete.remove();
                            originalRows = originalRows.filter(r => r !== rowToDelete);
                            updateStats();
                        }, 300);
                    }

                    // Show success message with custom alert
                    await showConfirm(
                        'Success',
                        'Query has been deleted successfully!',
                        '✅',
                        null,
                        null
                    );
                } else {
                    throw new Error(result.error || 'Failed to delete query');
                }
            } catch (error) {
                console.error('Error deleting query:', error);

                // Show error message with custom alert
                await showConfirm(
                    'Error',
                    'Failed to delete query. Please try again later.',
                    '❌',
                    null,
                    null
                );

                // Re-enable delete button
                const deleteBtn = document.getElementById('modal-delete-btn');
                if (deleteBtn) {
                    deleteBtn.disabled = false;
                    deleteBtn.textContent = '🗑️ Delete Query';
                }
            }
        }

        // Export filtered results to CSV
        function exportFiltered() {
            const visibleRows = originalRows.filter(row => !row.classList.contains('hidden'));

            if (visibleRows.length === 0) {
                showConfirm(
                    'No Data',
                    'No data available to export. Please adjust your filters.',
                    'ℹ️'
                );
                return;
            }

            let csv = 'Timestamp,Name,Email,Type,Priority,Subject,Message\n';

            visibleRows.forEach(row => {
                const cells = row.cells;
                const rowData = [
                    `"${cells[0].textContent.trim()}"`, // timestamp
                    `"${cells[1].textContent.trim()}"`, // name
                    `"${cells[2].querySelector('a') ? cells[2].querySelector('a').textContent.trim() : cells[2].textContent.trim()}"`, // email
                    `"${cells[3].textContent.trim().replace(/\s+/g, ' ')}"`, // type
                    `"${cells[4].textContent.trim()}"`, // priority
                    `"${cells[5].textContent.trim()}"`, // subject
                    `"${row.dataset.query || ''}"` // message from data attribute
                ];
                csv += rowData.join(',') + '\n';
            });

            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `queries_filtered_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Setup event listeners for filters
        function setupEventListeners() {
            const searchName = document.getElementById('search-name');
            const searchEmail = document.getElementById('search-email');
            const filterType = document.getElementById('filter-type');
            const filterPriority = document.getElementById('filter-priority');
            const filterDate = document.getElementById('filter-date');

            if (searchName) searchName.addEventListener('input', filterTable);
            if (searchEmail) searchEmail.addEventListener('input', filterTable);
            if (filterType) filterType.addEventListener('change', filterTable);
            if (filterPriority) filterPriority.addEventListener('change', filterTable);
            if (filterDate) filterDate.addEventListener('change', filterTable);
        }

        // Show query dialog
        function showQueryDialog(row) {
            try {
                // Get data from row attributes
                const subject = row.dataset.subject || 'No subject';
                const name = row.dataset.fullName || 'Unknown';
                const email = row.dataset.fullEmail || '';
                const type = row.dataset.contactType || 'Unknown';
                const priority = row.dataset.priority || 'medium';
                const query = row.dataset.query || '';
                const timestamp = row.dataset.timestamp || '';

                // Populate modal content
                const modalSubject = document.getElementById('modal-subject');
                const modalFrom = document.getElementById('modal-from');
                const modalRelated = document.getElementById('modal-related');
                const modalPriority = document.getElementById('modal-priority');
                const modalBody = document.getElementById('modal-body');

                if (modalSubject) modalSubject.textContent = subject;
                if (modalFrom) modalFrom.textContent = `${name} (${email})`;
                if (modalRelated) modalRelated.textContent = type;
                if (modalBody) modalBody.textContent = query;

                // Create priority badge
                if (modalPriority) {
                    modalPriority.innerHTML = `<span class="priority-badge priority-${priority.toLowerCase()}">${priority.toUpperCase()}</span>`;
                }

                // Setup action buttons
                const replyBtn = document.getElementById('modal-reply-btn');
                const deleteBtn = document.getElementById('modal-delete-btn');

                if (replyBtn) {
                    replyBtn.onclick = function () {
                        replyToQuery(email, subject);
                        closeDialog();
                    };
                }

                if (deleteBtn) {
                    deleteBtn.onclick = function () {
                        deleteQueryByTimestamp(timestamp);
                    };
                }

                // Show dialog
                const dialog = document.getElementById('queryDialog');
                if (dialog) {
                    dialog.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            } catch (error) {
                console.error('Error showing query dialog:', error);
                showConfirm(
                    'Error',
                    'Error displaying query details. Please try again.',
                    '❌'
                );
            }
        }

        // Close dialog
        function closeDialog(event) {
            if (event && event.target !== event.currentTarget) {
                return;
            }

            document.getElementById('queryDialog').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Close alert dialog on Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                const alertDialog = document.getElementById('alertDialog');
                const queryDialog = document.getElementById('queryDialog');

                if (alertDialog && alertDialog.style.display === 'flex') {
                    alertDialog.style.display = 'none';
                    document.body.style.overflow = 'auto';
                } else if (queryDialog && queryDialog.style.display === 'flex') {
                    closeDialog();
                }
            }
        });

        // Filter table based on all criteria
        function filterTable() {
            const nameFilter = document.getElementById('search-name').value.toLowerCase();
            const emailFilter = document.getElementById('search-email').value.toLowerCase();
            const typeFilter = document.getElementById('filter-type').value;
            const priorityFilter = document.getElementById('filter-priority').value;
            const dateFilter = document.getElementById('filter-date').value;

            let visibleCount = 0;

            originalRows.forEach(row => {
                const name = row.dataset.name || '';
                const email = row.dataset.email || '';
                const type = row.dataset.type || '';
                const priority = row.dataset.priority || '';
                const timestamp = row.dataset.timestamp || '';
                const rowDate = timestamp.split(' ')[0]; // Extract date part

                const nameMatch = !nameFilter || name.includes(nameFilter);
                const emailMatch = !emailFilter || email.includes(emailFilter);
                const typeMatch = !typeFilter || type === typeFilter;
                const priorityMatch = !priorityFilter || priority === priorityFilter;

                // Date matching - convert input date to dd/mm/yyyy format for comparison
                let dateMatch = true;
                if (dateFilter) {
                    const inputDate = new Date(dateFilter);
                    const inputFormatted = `${inputDate.getDate().toString().padStart(2, '0')}/${(inputDate.getMonth() + 1).toString().padStart(2, '0')}/${inputDate.getFullYear()}`;
                    dateMatch = rowDate === inputFormatted;
                }

                if (nameMatch && emailMatch && typeMatch && priorityMatch && dateMatch) {
                    row.classList.remove('hidden');
                    visibleCount++;
                } else {
                    row.classList.add('hidden');
                }
            });

            // Show/hide no results message
            const noResults = document.getElementById('no-results');
            if (visibleCount === 0) {
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
            }

            // Update filtered count and other stats
            updateStats();
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('search-name').value = '';
            document.getElementById('search-email').value = '';
            document.getElementById('filter-type').value = '';
            document.getElementById('filter-priority').value = '';
            document.getElementById('filter-date').value = '';

            // Show all rows
            originalRows.forEach(row => {
                row.classList.remove('hidden');
            });

            // Update stats
            updateStats();

            // Hide no results message
            document.getElementById('no-results').style.display = 'none';
        }

        // Sort table functionality
        function sortTable(columnIndex) {
            const tbody = document.getElementById('queries-tbody');
            const rows = Array.from(tbody.querySelectorAll('tr:not(.hidden)'));

            // Toggle sort direction
            sortDirection[columnIndex] = sortDirection[columnIndex] === 'asc' ? 'desc' : 'asc';

            rows.sort((a, b) => {
                let aVal = a.cells[columnIndex].textContent.trim();
                let bVal = b.cells[columnIndex].textContent.trim();

                // Handle date sorting
                if (columnIndex === 0) {
                    aVal = new Date(aVal.replace(/(\d+)\/(\d+)\/(\d+)/, '$2/$1/$3'));
                    bVal = new Date(bVal.replace(/(\d+)\/(\d+)\/(\d+)/, '$2/$1/$3'));
                }

                if (aVal < bVal) return sortDirection[columnIndex] === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection[columnIndex] === 'asc' ? 1 : -1;
                return 0;
            });

            // Re-append sorted rows
            rows.forEach(row => tbody.appendChild(row));
        }
    </script>
</body>

</html>
<!-- <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='modern-styles.css') }}">
    <title>Contact Queries - Admin Panel</title>
    <script src="{{ url_for('static', filename='this-script.js') }}"></script>
    <style>
        .clickable-row {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .clickable-row:hover {
            background-color: #f8fafc;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .clickable-row:active {
            transform: translateY(0);
        }

        /* Dialog Overlay Styles */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(2.5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .dialog-card {
            background: white;
            border-radius: 15px;
            padding: 0;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            animation: slideUp 0.3s ease forwards;
            position: relative;
        }

        .dialog-header {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 15px 15px 0 0;
        }

        .dialog-title {
            font-size: 1rem;
            font-weight: bold;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .dialog-content {
            padding: 2rem;
            max-height: 60vh;
            overflow-y: auto;
        }

        .query-info-grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .info-item {
            border-left: 4px solid #2563eb;
            padding-left: 1rem;
        }

        .info-label {
            font-weight: bold;
            color: #374151;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .info-value {
            color: #1f2937;
            font-size: 1rem;
            word-wrap: break-word;
        }

        .priority-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .message-body {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .dialog-actions {
            display: flex;
            gap: 1rem;
            padding: 0 2rem 2rem 2rem;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-reply {
            background: #2563eb;
            color: white;
            margin: 0.15rem;
        }

        .btn-reply:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .btn-delete {
            background: #dc2626;
            color: white;
            margin: 0.15rem;
        }

        .btn-delete:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }

        .btn-delete:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .btn-view-details {
            background: #059669;
            color: white;
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-view-details:hover {
            background: #047857;
            transform: translateY(-1px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .dialog-card {
                width: 95%;
                max-height: 90vh;
            }

            .dialog-header {
                padding: 1rem 1.5rem;
            }

            .dialog-content {
                padding: 1.5rem;
            }

            .dialog-actions {
                padding: 0 1.5rem 1.5rem 1.5rem;
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="nav-left">
            <a href="{{ url_for('index') }}" class="app-name"
                style="display: flex; justify-content: center; align-items: center;">
                <img style="border-radius: 50%;margin-right: 8px;"
                    src="{{ url_for('static', filename='mProvMEds-logo-Icon-circular.png') }}"
                    alt="mProvMeds Logo" height="40" width="40">
                mProvMeds: Admin
            </a>
            <div style="border-left: 3px solid #2563eb;height: 45px;"></div>

            <ul class="nav-links">
                <li><a href="{{ url_for('index_form') }}" class="nav-link">Create Prediction</a></li>
                <li><a href="{{ url_for('my_predictions') }}" class="nav-link">My Predictions</a></li>
                <li><a href="{{ url_for('about') }}" class="nav-link">About Us</a></li>
            </ul>
        </div>

        {% if username %}
        <div class="user-dropdown">
            <button class="user-button" onclick="toggleDropdown()">
                <span id="userName">{{ username }}</span>
                <span class="dropdown-arrow">▼</span>
            </button>
            <div class="dropdown-menu" id="dropdownMenu">
                <div class="dropdown-item">Signed in as <strong>{{ username }}</strong></div>
                <div class="dropdown-item">
                    <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
                </div>
            </div>
        </div>
        {% endif %}
    </nav>

    <div class="dialog-overlay" id="queryDialog" onclick="closeDialog(event)">
        <div class="dialog-card" onclick="event.stopPropagation()">
            <div class="dialog-header">
                <h2 class="dialog-title">Query Details</h2>
                <button class="close-btn" onclick="closeDialog()">&times;</button>
            </div>
            <div class="dialog-content">
                <div class="query-info-grid">
                    <div class="info-item">
                        <div class="info-label">Subject</div>
                        <div class="info-value" id="modal-subject"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">From</div>
                        <div class="info-value" id="modal-from"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Related To</div>
                        <div class="info-value" id="modal-related"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Priority</div>
                        <div class="info-value" id="modal-priority"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Message Body</div>
                        <div class="message-body" id="modal-body"></div>
                    </div>
                </div>
            </div>
            <div class="dialog-actions">
                <button class="action-btn btn-reply" id="modal-reply-btn">
                    📧 Reply via Email
                </button>
                <button class="action-btn btn-delete" id="modal-delete-btn">
                    🗑️ Delete Query
                </button>
            </div>
        </div>
    </div>

    <div class="container main-content fade-in">
        <div class="queries-container">
            <h2 style="color: var(--primary-color); margin-bottom: 1.5rem; text-align: center;">
                Admin Console | Contact Queries Management
            </h2>


            <div class="stats-cards-1">
                <div class="stat-card-1">
                    <h3 id="total-queries">0</h3>
                    <p>Total Queries</p>
                </div>
                <div class="stat-card-1" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <h3 id="filtered-queries">0</h3>
                    <p>Filtered Results</p>
                </div>
                <div class="stat-card-1" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <h3 id="pending-queries">0</h3>
                    <p>High Priority</p>
                </div>
                <div class="stat-card-1" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                    <h3 id="today-queries">0</h3>
                    <p>Today's Queries</p>
                </div>
            </div>


            <div class="filters-section">
                <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Filter & Search</h3>
                <div class="filter-grid">
                    <div class="filter-group">
                        <label for="search-name">Search - Name</label>
                        <input type="text" id="search-name" placeholder="Enter name...">
                    </div>
                    <div class="filter-group">
                        <label for="search-email">Search - Email</label>
                        <input type="email" id="search-email" placeholder="Enter email...">
                    </div>
                    <div class="filter-group" style="width:140px;">
                        <label for="filter-type">Type</label>
                        <select id="filter-type">
                            <option value="">All Types</option>
                            <option value="contact">Contact</option>
                            <option value="suggestion">Suggestion</option>
                            <option value="report">Report</option>
                            <option value="feedback">Feedback</option>
                            <option value="support">Support</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="filter-group" style="width:130px;">
                        <label for="filter-priority">Priority</label>
                        <select id="filter-priority">
                            <option value="">All Priorities</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="filter-group" style="width:130px;">
                        <label for="filter-date">Date</label>
                        <input type="date" id="filter-date">
                    </div>
                    <div class="filter-group" style="width:130px;">
                        <button onclick="exportFiltered()" class="export-btn">
                            Export ↗️
                        </button>
                    </div>
                    <div class="filter-group" style="width:130px;">
                        <button onclick="clearFilters()" class="btn btn-outline"
                            style="padding: 0.5rem 1rem;color:white;background:red;border: 2px solid white;">
                            Clear
                        </button>
                    </div>
                </div>
            </div>
            <div class="table-container">
                <table class="queries-table" id="queries-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">Date/Time ↕</th>
                            <th onclick="sortTable(1)">Name ↕</th>
                            <th onclick="sortTable(2)">Email ↕</th>
                            <th onclick="sortTable(3)">Type ↕</th>
                            <th onclick="sortTable(4)">Priority ↕</th>
                            <th>Subject</th>
                        </tr>
                    </thead>
                    <tbody id="queries-tbody">
                        {% for query in queries %}
                        <tr data-timestamp="{{ query.timestamp }}" data-name="{{ query.name.lower() }}"
                            data-email="{{ query.email.lower() }}" data-type="{{ query.contact_type }}"
                            data-priority="{{ query.priority }}" data-subject="{{ query.subject or 'No subject' }}"
                            data-full-name="{{ query.name }}" data-full-email="{{ query.email }}"
                            data-contact-type="{{ query.contact_type.title() }}" data-query="{{ query.query }}"
                            class="clickable-row" onclick="showQueryDialog(this)" title="View details">
                            <td>{{ query.timestamp }}</td>
                            <td>{{ query.name }}</td>
                            <td style="max-width:10rem"><a href="mailto:{{ query.email }}"
                                    style="color: var(--primary-color);" onclick="event.stopPropagation()">{{
                                    query.email }}</a></td>
                            <td>
                                <span class="type-badge type-{{ query.contact_type }}">
                                    {{ query.contact_type.title() }}
                                </span>
                            </td>
                            <td class="priority-{{ query.priority }}">{{ query.priority.title() }}</td>
                            <td>{{ query.subject or 'No subject' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div id="no-results" class="no-results" style="display: none;">
                    No queries match your current filters.
                </div>
            </div>
        </div>
    </div>
    <br><br>
    <footer class="site-footer">
        <div class="footer-content"><br><br>
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>🏥 About mProvMeds</h3>
                    <p style="text-align:justify;">We are a team of dedicated individuals working to provide valuable
                        predictions and insights into various diseases based on symptoms input. Our goal is to improve
                        healthcare outcomes and empower individuals to make informed decisions about their health.</p>
                    <a href="#" title="LinkedIn">
                        <p
                            style="display: inline-flex;align-items: center;justify-content: center;margin-top:0.6rem;letter-spacing:2.5px;">
                            <img style="margin-right:4px;" src="https://www.svgrepo.com/show/157006/linkedin.svg"
                                height="22.5" width="22.5">
                            LinkedIn
                        </p>
                    </a>
                    <a style="color:transparent;height:rem;">_</a>
                    <a style="border-left: 3px solid #2563eb;color:transparent;height:2rem;font-size:2rem;">_</a>
                    <a href="#" title="Github">
                        <p
                            style="display: inline-flex;align-items: center;justify-content: center;margin-top:0.6rem;letter-spacing:2.5px;">
                            <img style="margin-right:4px;" src="https://www.svgrepo.com/show/512317/github-142.svg"
                                height="22.5" width="22.5">
                            Github
                        </p>
                    </a>
                </div>

                <div class="footer-section" style="padding-left:45px;">
                    <h3>🔗 Quick Links</h3>
                    <ul>
                        <li><a href="{{ url_for('index') }}">🏠 Home</a></li>
                        <li><a href="{{ url_for('index_form') }}">➕ Create New Prediction</a></li>
                        <li><a href="{{ url_for('my_predictions') }}">📊 My Predictions</a></li>
                        <li><a href="{{ url_for('about') }}">ℹ️ About Us</a></li>
                        <li>
                            <p style="font-size:0%;">.</p>
                        </li>
                        <li>
                            <p style="font-size:0%;">.</p>
                        </li>
                        <li><a href="{{ url_for('contact') }}">📞 Contact Support</a></li>
                        <li><a href="#">📋 Terms of Service</a></li>
                        <li><a href="#">🔒 Privacy Policy</a></li>
                    </ul>
                </div>


                <div class="footer-section">
                    <h3>📍 Contact Information</h3>
                    <p>📧 Email:<br> <a href="mailto:mistrytushar07@gmail.com">mistrytushar07@gmail.com</a></p>
                    <p style="font-size:0%;">.</p>
                    <p>📱 Phone:<br> +91 987-654-3210</p>
                    <p style="font-size:0%;">.</p>
                    <p>🏢 Address: <br>Academic Office, VIT Bhopal University,<br>
                        Bhopal, Madhya Pradesh, India</p>
                    <p style="font-size:0%;">.</p>
                </div>
            </div>
            <br>

            <div class="disclaimer-box">
                <h4>⚠️ Important Medical Disclaimer</h4>
                <p style="text-align:justify; color: #dfdfdf">This application is for informational and educational
                    purposes only. It is not intended to be a substitute for professional medical advice, diagnosis, or
                    treatment. Always seek the advice of your physician or other qualified health provider with any
                    questions you may have regarding a medical condition. Never disregard professional medical advice or
                    delay in seeking it because of something you have read on this application.</p>
            </div>

            <div class="footer-bottom">
                <div class="copyright-info">
                    <p style="font-size:1rem;"><br>
                        &copy; 2023 mProvMeds - Healthcare Improvements Platform. All rights reserved. | Powered by
                        NAMETAG</p>
                </div>

                <p style="margin-top: 1rem; color: #d1d5db; font-size: 0.9rem;">
                    Version {{ver}} | Last Updated: {{updatedOn}} |
                    <a href="{{ url_for('contact') }}" style="color: #93c5fd;">Report Issues</a> |
                    <a href="{{ url_for('contact') }}" style="color: #93c5fd;">Suggest Features</a>
                </p>
                <p style="margin-top: 1rem; color: #d1d5db; font-size: 0.9rem;">
                    <a href="https://www.python.org/" target="_blank" style="color: #93c5fd; font-size: 0.75rem;">
                        Python</a> |
                    <a href="https://www.google.com/search?q=machine+learning&rlz=1C1VDKB_enIN988IN988&oq=MAchine&gs_lcrp=EgZjaHJvbWUqDwgBEAAYQxixAxiABBiKBTIMCAAQRRg5GLEDGIAEMg8IARAAGEMYsQMYgAQYigUyCggCEAAYsQMYgAQyBwgDEAAYgAQyBwgEEAAYgAQyCggFEAAYsQMYgAQyBggGEEUYPTIGCAcQRRhB0gEIMzU1NmowajSoAgCwAgA&sourceid=chrome&ie=UTF-8"
                        target="_blank" style="color: #93c5fd; font-size: 0.75rem;">
                        Machine Learning</a> |
                    <a href="https://flask.palletsprojects.com" target="_blank"
                        style="color: #93c5fd; font-size: 0.75rem;">
                        Flask</a> |
                    <a href="https://www.google.com/search?q=html+css&sca_esv=71a2141a21d8c97d&rlz=1C1VDKB_enIN988IN988&sxsrf=AE3TifMumyHis7wMC95WamCUIAtFR_neXg%3A1756302710342&ei=dg2vaKzfFOrdseMP2722-A4&ved=0ahUKEwis8qu5kauPAxXqbmwGHdueDe8Q4dUDCBA&uact=5&oq=html+css&gs_lp=Egxnd3Mtd2l6LXNlcnAiCGh0bWwgY3NzMgUQABiABDIFEAAYgAQyCBAAGIAEGLEDMgUQABiABDIFEAAYgAQyBRAAGIAEMgUQABiABDIFEAAYgAQyBRAAGIAEMggQABiABBixA0ixL1CGKVjRLnACeAGQAQCYAcUBoAGFBKoBAzAuM7gBA8gBAPgBAZgCBaACsgTCAgcQIxiwAxgnwgIKEAAYsAMY1gQYR8ICChAjGIAEGCcYigXCAg0QABiABBixAxhDGIoFwgIKEAAYgAQYQxiKBcICDhAAGIAEGLEDGIMBGIoFwgILEAAYgAQYsQMYgwGYAwCIBgGQBgqSBwUyLjIuMaAHhxOyBwUwLjIuMbgHmwTCBwUyLTQuMcgHJQ&sclient=gws-wiz-serp"
                        target="_blank" style="color: #93c5fd; font-size: 0.75rem;">
                        HTML5/CSS3</a> |
                    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank"
                        style="color: #93c5fd; font-size: 0.75rem;">
                        JavaScript</a> |
                    <a href="https://developer.mozilla.org/en-US/docs/Learn_web_development/Core/CSS_layout/Responsive_Design"
                        target="_blank" style="color: #93c5fd; font-size: 0.75rem;">
                        Responsive Design</a>
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let originalRows = [];
        let sortDirection = {};

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            // Check if we're on the queries page
            const queriesTable = document.getElementById('queries-table');
            if (queriesTable) {
                originalRows = Array.from(document.querySelectorAll('#queries-tbody tr'));
                updateStats();
                setupEventListeners();
            }
        });

        function updateStats() {
            const totalQueries = originalRows.length;
            const visibleQueries = originalRows.filter(row => !row.classList.contains('hidden')).length;
            const highPriorityQueries = originalRows.filter(row =>
                row.dataset.priority === 'high' && !row.classList.contains('hidden')).length;

            // Count today's queries - using dd/mm/yyyy format
            const today = new Date();
            const todayFormatted = `${today.getFullYear()}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;

            const todayQueries = originalRows.filter(row => {
                const rowDate = row.dataset.timestamp.split(' ')[0];
                return rowDate === todayFormatted && !row.classList.contains('hidden');
            }).length;

            document.getElementById('total-queries').textContent = totalQueries;
            document.getElementById('filtered-queries').textContent = visibleQueries;
            document.getElementById('pending-queries').textContent = highPriorityQueries;
            document.getElementById('today-queries').textContent = todayQueries;
        }

        // Reply to query
        function replyToQuery(email, subject) {
            const replySubject = subject ? `Re: ${subject}` : 'Re: Your inquiry';
            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(replySubject)}`;
            window.location.href = mailtoLink;
        }

        // Delete query with backend integration
        async function deleteQueryByTimestamp(timestamp) {
            try {
                // Disable delete button to prevent multiple clicks
                const deleteBtn = document.getElementById('modal-delete-btn');
                if (deleteBtn) {
                    deleteBtn.disabled = true;
                    deleteBtn.textContent = '🗑️ Deleting...';
                }

                const response = await fetch('/queries/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ timestamp: timestamp })
                });

                const result = await response.json();

                if (result.success) {
                    // Find and remove the row from DOM
                    const rowToDelete = originalRows.find(row => row.dataset.timestamp === timestamp);
                    if (rowToDelete) {
                        rowToDelete.style.transition = 'opacity 0.3s ease';
                        rowToDelete.style.opacity = '0';
                        
                        setTimeout(() => {
                            rowToDelete.remove();
                            originalRows = originalRows.filter(r => r !== rowToDelete);
                            updateStats();
                        }, 300);
                    }
                    
                    // Show success message
                    alert('Query deleted successfully!');
                } else {
                    throw new Error(result.error || 'Failed to delete query');
                }
            } catch (error) {
                console.error('Error deleting query:', error);
                alert('Failed to delete query. Please try again.');
                
                // Re-enable delete button
                const deleteBtn = document.getElementById('modal-delete-btn');
                if (deleteBtn) {
                    deleteBtn.disabled = false;
                    deleteBtn.textContent = '🗑️ Delete Query';
                }
            }
        }

        // Export filtered results to CSV
        function exportFiltered() {
            const visibleRows = originalRows.filter(row => !row.classList.contains('hidden'));

            if (visibleRows.length === 0) {
                alert('No data to export');
                return;
            }

            let csv = 'Timestamp,Name,Email,Type,Priority,Subject,Message\n';

            visibleRows.forEach(row => {
                const cells = row.cells;
                const rowData = [
                    `"${cells[0].textContent.trim()}"`, // timestamp
                    `"${cells[1].textContent.trim()}"`, // name
                    `"${cells[2].querySelector('a') ? cells[2].querySelector('a').textContent.trim() : cells[2].textContent.trim()}"`, // email
                    `"${cells[3].textContent.trim().replace(/\s+/g, ' ')}"`, // type
                    `"${cells[4].textContent.trim()}"`, // priority
                    `"${cells[5].textContent.trim()}"`, // subject
                    `"${row.dataset.query || ''}"` // message from data attribute
                ];
                csv += rowData.join(',') + '\n';
            });

            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `queries_filtered_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Setup event listeners for filters
        function setupEventListeners() {
            const searchName = document.getElementById('search-name');
            const searchEmail = document.getElementById('search-email');
            const filterType = document.getElementById('filter-type');
            const filterPriority = document.getElementById('filter-priority');
            const filterDate = document.getElementById('filter-date');

            if (searchName) searchName.addEventListener('input', filterTable);
            if (searchEmail) searchEmail.addEventListener('input', filterTable);
            if (filterType) filterType.addEventListener('change', filterTable);
            if (filterPriority) filterPriority.addEventListener('change', filterTable);
            if (filterDate) filterDate.addEventListener('change', filterTable);
        }

        // Show query dialog
        function showQueryDialog1(button) {
            try {
                // Get data from button attributes
                const subject = button.dataset.subject || 'No subject';
                const name = button.dataset.name || 'Unknown';
                const email = button.dataset.email || '';
                const type = button.dataset.type || 'Unknown';
                const priority = button.dataset.priority || 'medium';
                const query = button.dataset.query || '';
                const timestamp = button.dataset.timestamp || '';

                // Populate modal content
                const modalSubject = document.getElementById('modal-subject');
                const modalFrom = document.getElementById('modal-from');
                const modalRelated = document.getElementById('modal-related');
                const modalPriority = document.getElementById('modal-priority');
                const modalBody = document.getElementById('modal-body');

                if (modalSubject) modalSubject.textContent = subject;
                if (modalFrom) modalFrom.textContent = `${name} (${email})`;
                if (modalRelated) modalRelated.textContent = type;
                if (modalBody) modalBody.textContent = query;

                // Create priority badge
                if (modalPriority) {
                    modalPriority.innerHTML = `<span class="priority-badge priority-${priority.toLowerCase()}">${priority.toUpperCase()}</span>`;
                }

                // Setup action buttons
                const replyBtn = document.getElementById('modal-reply-btn');
                const deleteBtn = document.getElementById('modal-delete-btn');

                if (replyBtn) {
                    replyBtn.onclick = function () {
                        replyToQuery(email, subject);
                        closeDialog();
                    };
                }

                if (deleteBtn) {
                    deleteBtn.onclick = function () {
                        if (confirm('Are you sure you want to delete this query?')) {
                            deleteQueryByTimestamp(timestamp);
                            closeDialog();
                        }
                    };
                }

                // Show dialog
                const dialog = document.getElementById('queryDialog');
                if (dialog) {
                    dialog.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            } catch (error) {
                console.error('Error showing query dialog:', error);
                alert('Error displaying query details. Please try again.');
            }
        }

        // Close dialog
        function closeDialog(event) {
            if (event && event.target !== event.currentTarget) {
                return;
            }

            document.getElementById('queryDialog').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Close dialog on Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closeDialog();
            }
        });

        // Filter table based on all criteria
        function filterTable() {
            const nameFilter = document.getElementById('search-name').value.toLowerCase();
            const emailFilter = document.getElementById('search-email').value.toLowerCase();
            const typeFilter = document.getElementById('filter-type').value;
            const priorityFilter = document.getElementById('filter-priority').value;
            const dateFilter = document.getElementById('filter-date').value;

            let visibleCount = 0;

            originalRows.forEach(row => {
                const name = row.dataset.name || '';
                const email = row.dataset.email || '';
                const type = row.dataset.type || '';
                const priority = row.dataset.priority || '';
                const timestamp = row.dataset.timestamp || '';
                const rowDate = timestamp.split(' ')[0]; // Extract date part

                const nameMatch = !nameFilter || name.includes(nameFilter);
                const emailMatch = !emailFilter || email.includes(emailFilter);
                const typeMatch = !typeFilter || type === typeFilter;
                const priorityMatch = !priorityFilter || priority === priorityFilter;
                const dateMatch = !dateFilter || rowDate === dateFilter;

                if (nameMatch && emailMatch && typeMatch && priorityMatch && dateMatch) {
                    row.classList.remove('hidden');
                    visibleCount++;
                } else {
                    row.classList.add('hidden');
                }
            });

            // Show/hide no results message
            const noResults = document.getElementById('no-results');
            if (visibleCount === 0) {
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
            }

            // Update filtered count
            document.getElementById('filtered-queries').textContent = visibleCount;
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('search-name').value = '';
            document.getElementById('search-email').value = '';
            document.getElementById('filter-type').value = '';
            document.getElementById('filter-priority').value = '';
            document.getElementById('filter-date').value;
        }// Show query dialog
        function showQueryDialog(row) {
            try {
                // Get data from row attributes
                const subject = row.dataset.subject || 'No subject';
                const name = row.dataset.fullName || 'Unknown';
                const email = row.dataset.fullEmail || '';
                const type = row.dataset.contactType || 'Unknown';
                const priority = row.dataset.priority || 'medium';
                const query = row.dataset.query || '';
                const timestamp = row.dataset.timestamp || '';

                // Populate modal content
                const modalSubject = document.getElementById('modal-subject');
                const modalFrom = document.getElementById('modal-from');
                const modalRelated = document.getElementById('modal-related');
                const modalPriority = document.getElementById('modal-priority');
                const modalBody = document.getElementById('modal-body');

                if (modalSubject) modalSubject.textContent = subject;
                if (modalFrom) modalFrom.textContent = `${name} (${email})`;
                if (modalRelated) modalRelated.textContent = type;
                if (modalBody) modalBody.textContent = query;

                // Create priority badge
                if (modalPriority) {
                    modalPriority.innerHTML = `<span class="priority-badge priority-${priority.toLowerCase()}">${priority.toUpperCase()}</span>`;
                }

                // Setup action buttons
                const replyBtn = document.getElementById('modal-reply-btn');
                const deleteBtn = document.getElementById('modal-delete-btn');

                if (replyBtn) {
                    replyBtn.onclick = function () {
                        replyToQuery(email, subject);
                        closeDialog();
                    };
                }

                if (deleteBtn) {
                    deleteBtn.onclick = function () {
                        if (confirm('Are you sure you want to delete this query?')) {
                            deleteQueryByTimestamp(timestamp);
                            closeDialog();
                        }
                    };
                }

                // Show dialog
                const dialog = document.getElementById('queryDialog');
                if (dialog) {
                    dialog.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            } catch (error) {
                console.error('Error showing query dialog:', error);
                alert('Error displaying query details. Please try again.');
            }
        }</script>
</body>

</html> -->